# 3.2 GridDB

GridDB ist eine verteilte hochskalierbare NoSQL-Zeitreihendatenbank. Sie weist eine sehr hohe Performanz auf und ist für *IoT* (kurz für: *Internet of Things*) sowie Big Data optimiert [GridDB DB-Engine]. GridDB wird von Toshiba Corporation seit 2011 entwickelt. Der erste kommerzielle Release war 2013, 2016 wurde der Quellcode öffentlich zur Verfügung gestellt. [1]

Momentan gibt es drei Ausprägungen einer GridDB: 
- GridDB *Standard Edition*
- GridDB *Advanced Edition*
- GridDB *Vector Edition*
Die *Advanced Edition* ist um die Fähigkeit der SQL-Verarbeitung erweitert. Die *Vector Edition* bietet zusätzlich zur *Advanced Edition* die Verarbeitung von hochdimensionalen Vektordaten, die für die Bilderfassung oder für das *Maschinelle Lernen* (engl.: *Machine Learning*) in der Big-Data-Analyse verwendet wird. [GridDB Technical Reference]

+++Scale-out+++ +++horizontale Skalierung+++ [GridDB Technical Reference]
The number of servers can be increased up to 1000 units ((Quick Start))

## Datenmodell/-struktur

### Key-Value-Store

GridDB integriert eine der vier NoSQL-Technologien: den Key-Value-Store. Dabei handelt es sich um eine Datenbank mit eindeutigen Schlüsseln und zugeordneten Werten. Da die Key-Value-Stores mit ihren Schlüssel-Werte-Paaren einfache Strukturen haben und sie den Arbeitsspeicher von Rechnern nutzen (In-Memory), können ihre Datensätze ressourcenschonend sehr schnell geschrieben und gelesen werden. Sie können als volatiler Zwischenspeicher zur Optimierung von Applikationen und zur Reduzierung der Zugriffszeiten eingesetzt werden. Key-Value-Datenbanken können einfach sklaliert werden und eignen sich aus diesem Grund für das Cloud-Computing [E. Schicker, Datenbanken und SQL]. [D. Fasel und A. Meier, Big data][Key-Value-Store, DB-Engine]

Key-Value-Stores gelten als schemalose Datenbanken. Der Schlüsselraum kann zwar mittels Sonderzeichen wie Doppelpunkten oder Schrägstrichen rudimentär strukturiert werden. Ansonsten unterstützen Key-Value-Datenbanken keinerlei Strukturen, Referenzen oder Verschachtelungen. Datenobjekte können jederzeit in beliebigen Formaten gespeichert werden, ohne die Notwendigkeit eines vorab festgelegten Formats. Dies erhöht die Flexibilität von Key-Value-Datenbanken, beschleunigt die Abfragen und erleichtert die Partitionierung.

Eine Key-Value-Datenbank weist folgende Eigenschaften auf:
- Es gibt Datenobjekte, die zur Identifikation eingesetzt werden: die Schlüssel.
- Jedem Schlüssel wird ein Datenobjekt zugewiesen, das dessen Wert beschreibt.
- Unter Angabe des Schlüssels können die zugewiesenen Werte abgefragt werden.  

Die hohe Schreib- und Lesegeschwindigkeit kann einerseits dadurch erreicht werden, dass auf die Prüfung der *referentiellen Integrität* verzichtet wird, wonach in RDBMS die Beziehungen zwischen Datenobjekten kontrolliert werden. Andererseits kann die Performanz noch weiter gesteigert werden, indem die Schlüssel-Werte-Paare im Hauptspeicher der Datenbank zwischengespeichert werden. Key-Value-Stores sind In-Memory-Datenbanken. Sie verwenden Technologien, die Werte im Hauptspeicher puffern können, während diese permanent mit den persistenten Langzeit-Daten im Hintergrundspeicher überprüft werden.  
Durch das simple Datenmodell der Key-Value-Stores ist die Partitionierung sehr einfach. Einzelne Computer eines Clusters, die *Shards*, übernehmen einen Teil des Schlüsselraums. Dadurch kann die Datenbank auf mehrere Maschinen verteilt werden. Die Verteilung der Schlüssel erfolgt nach dem Prinzip des *Consistent Hashing* (engl. für: *Konsistente Hashfunktion*). Danach wird eine Speicheradresse oder ein Hashwert aus einem Satz von Schlüsseln berechnet, um einen neuen entsprechenden Datensatz zu speichern. Gemäß dessen werden in Big-Data-Anwendungen Schlüssel-Werte-Paare verschiedenen Knoten in einem Computernetzwerk zugeordnet. Ausgehend von den Schlüsseln werden deren Werte in den zugehörigen Knoten gespeichert. Mittels *Consistent Hashing* wird die Adressberechnung sowohl für die Knotenadressen als auch für die Speicheradressen der Datenobjekte verwendet (Key-Value).

[X] A. Meier und M. Kaufmann, SQL & NoSQL Databases (S. 202-205)


### Key-Container

Bei der GridDB wird die typische NoSQL-Technologie des Key-Value-Stores erweitert. Die unten stehende Abbildung zeigt unterschiedliche Datenmodelle im direkten Vergleich. Auf die in der Abbildung erwähnten Datenmodelle Key-Column und Key-Document wird hier nicht näher eingegangen. *Key-Value* wurde als Ausgangsbasis von GridDB bereits oben beschrieben. Das Datenmodell *Key-Container* ist eine Erweiterung des Key-Value-Stores und ist das von GridDB eingesetzte Datenmodell. [Imru]

![Datenmodelle im Vergleich](../images/key-value_key-container.jpg)
***Abbildung:** Datenmodelle im Vergleich: Key-Value, Key-Column, Key-Document und Key-Container* [Imru]

GridDB verwaltet Daten auf der Basis von *Blöcken*, *Containern* (*Tabellen*), *Reihen*, *Partitionen* und *Partitionsgruppen*. Ein *Block* ist eine Dateneinheit für die Verarbeitung persistenter Daten auf einem Festplattenspeicher. Es ist die kleinste physische Einheit der Datenverwaltung in einer GridDB. Mehrteilige Containerdaten werden in einem Block angeordnet. Die Blockgröße kann entweder 64 KB oder 1 MB betragen.  
Ein *Container* ist eine Datenstruktur, die als Oberfläche für den Nutzer dient. Er besteht aus mehreren Blöcken. Ein Block wird *Container* genannt, wenn auf Basis von *NoQL* gearbeitet wird, und *Tabelle*, wenn auf Basis von *NewSQL* gearbeitet wird. *NewSQL* bezieht sich auf Datenbankmanagementsysteme, die die Vorteile von klassischen RDBMS und NoSQL verbinden möchte. Es gibt zwei Datentypen: *Collection* (*Tabelle*) und *Time Series Container* (*Time Series Tabelle*).  
Eine *Row* (engl. für *Reihe*, auch *Zeile*) bezieht sich auf eine Datenzeile, die in einem Container eingetragen wird. Abhängig von der Eintragung und der Zeiteinteilung, werden die Daten in den passenden Blocks innerhalb von Partitionen. In der Regel gibt es Spalten mit mehreren Datentypen in einer Zeile.  
Eine *Partition* ist eine logische Datenverwaltungseinheit, die eine oder mehrere Container beinhaltet. Zwischen Clustern dient sie zur Verwaltung der Datenbewegungen, zur Regelung der Lastverteilung zwischen den Knoten sowie zur Mehrfachhaltung von Daten im Falle einer Störung. Eine *Partitionsgruppe* besteht auf mehreren Partitionen. [GridDB technical reference]

Bei dem Datenmodell des *Key Containers* werden Daten in Form einer *Collection* (engl. für: Kollektion, Sammlung) abgebildet und durch einen *Key* (engl. für: *Schlüssel*) referenziert. Dieses Prinzip kann in etwa dem von relationalen Datenbanken gleichgesetzt werden. Der *Key* entspricht dabei dem Tabellennamen und die *Collection* den Tabellendaten, die in einem *Container* zusammengefasst sind (vgl. unten stehende Abbildung). Auf diese Art können die Daten in einem Schema strukturiert werden, ähnlich wie in einer relationalen Datenbank. [3]

![Datenmodell mit Key-Container](../images/key-container_data-type.jpg)
***Abbildung:** Datenmodell mit Key-Container* [3]

In der GridDB werden sowohl *Collections* als auch *Time Series Container* unterstützt. Während für *Collections* beliebige Werte als *Keys* eingesetzt werden, verwenden *Time Series Container* einen *Zeit-Wert*. Auf diese Weise ist die Speicherung und der Zugang zu Meta-Informationen von Zeitreihen leichter zu handhaben, da der Wechsel zwischen verschiedenen APIs und Verbindungen entfällt. [3]  
Darüber hinaus können neben speziellen API-Aufrufen auch Abfragen über den Schlüssel durchgeführt werden, Zeitintervalle begrenzt werden oder Daten aus einem festgelegten zurückliegenden Zeitraum automatisch gelöscht werden. [Imru]

GridDB gilt als eine der schnellsten NoSQL-Datenbanken. Das liegt unter anderem daran, dass GridDB ebenso wie Key-Value-Datenbanken das In-Memory-Prinzip nutzt. Das alleinige Halten der Daten im flüchtigen Speicher reicht allerdings nicht aus. Wenn große Datenmengen verarbeitet werden sollen, sollte ein DBMS ebenso in der Lage sein, diese persistent auf Festplatten zu speichern. Um die Festplattenzugriffe so weit wie möglich zu reduzieren, werden Daten lokal begrenzt. Zu diesem Zweck platziert GridDB zusammenhängende Daten im selben Datenblock. Mittels *Hint*-Informationen (hint, engl. für: *Hinweis*) über die Daten stellt GridDB entsprechende Datenblöcke zusammen. Auf diese Weise werden fehlschlagende Speicherzugriffe reduziert und die Leistung verbessert. [Imru]

![Combined use of in-memory/disk](../images/feature_disk_and_memory.png)
***Abbildung:** GridDB-API-Processing mit In-Memory* [GridDB technical reference]

![GridDB Architecture](../images/griddb_in-memory.jpg)
***Abbildung:** Combined use of in-memory/disk* [Imru]

### Wide vs Narrow Data Tables

+++ Schema +++

## Partionierungsmechanismen

### Architektur
GridDB hat eine hybride Cluster-Architektur, die die *Peer-to-Peer-* und *Leader/Follower*-Topologien (neu für: *Master/Slave*) kombiniert. Alle Knoten eines Clusters sind identisch und ein Knoten wird entsprechend eines Algorithmus zum Master (Leader) gewählt. Der *Master-Knoten* und *Follower-Knoten* tauschen *Heartbeat*-Nachrichten (engl. für: Herzschlag) aus, um damit gegenseitig ihre Betriebsbereitschaft signalisieren. 
Knoten können für die Partitionen die Rolle des *Owners* (engl. für: Besitzer) oder des *Followers* (engl. für: Folger) übernehmen. Wenn ein Knoten die Rolle des *Owners* einer Partitionstabelle übernimmt, wird diese an den *Follower* weitergegeben und kopiert. Dieser übernimmt das *Backup* (engl. für: Datensicherung). Der Owner einer Partition hat Lese- und Schreibrechte, während das Backup lediglich lesende Operationen zulässt. [GridDB Reliability and Robustness]  

![GridDB-Architektur: Partitionen und Partitionsgruppen, Owner und Backup](../images/arc_DataPieces_2.png)
***Abbildung:** GridDB-Architektur: Partitionen und Partitionsgruppen, Owner und Backup* [What is GridDB]

### Partitionierung

Eine GridDB-Partition ist ein logischer Bereich, der ganze Container speichert und für den Nutzer nicht direkt sichtbar ist. Ein Hash-Algorithmus, der den Container-Schlüssel als Startwert benutzt, entscheidet darüber, welcher Partition ein Container zugewiesen wird. Eine Zuordnungstabelle eines Knotens zu jeder Partition wird *Partitionstabelle* genannt. Der Master-Knoten verteilt diese Partitionstabelle an die Follower-Knoten oder Client-Bibliotheken. Indem die Partitionstabelle referenziert wird, werden der Owner-Knoten und der Backup-Knoten bekanntgegeben. Da in einer GridDB komplette Container in den Partitionen abgespeichert werden, sind die Zugriffe innerhalb eines Containers immer schnell, da eine knotenübergreifende Kommunikation und Koordination nicht erfordlich ist. [NoSQL Database Architectural Comparison]

Fällt der Master-Knoten aus, erhalten die Follower-Knoten kein Heartbeat-Signal. Unter den Follower-Knoten wird mittels Algorithmus ein neuer Master-Knoten gewählt. Da alle Follower-Knoten eine Kopie der *Partitions-Tabelle* (s.a untenstehend *Partitionierung*) besitzen, kann der Cluster innerhalb weniger Sekunden die normalen Operationen fortsetzen. [GridDB Reliability and Robustness]  
Auf diese Weise wird das Risiko, das ein alleiniger Master ohne Replikation mit sich bringen würde (*single-point of failure*, kurz: *SPOF*), reduziert. [NoSQL Database Architectural Comparison]

Um die Bearbeitungsgeschwindigkeit von Anwendungen zu erhöhen, die mit mehreren Knoten eines Clusters verbunden sind, ist es wichtig, die Daten bestmöglich für die Verarbeitung im Speicher vorzubereiten. Dies erfolgt in einer GridDB mittels *Sharding* [GridDB Systemeigenschaften]. Zu diesem Zweck werden bei großen Tabellen mit einer großen Zeilenanzahl die Zeilen in internen Containern, den *Data-Partitions* (engl. für: Datenpartitionen) gespeichert und auf verschiedene Knoten verteilt. Die Zuordnung jeder Zeile zu den *Data-Partitions* wird über eine Spalte mit den *Partitionsschlüsseln* bestimmt, die sich aus der Zeit der Tabellenerstellung ergibt. Die unten stehende Abbildung zeigt die Partitionierung in einer GridDB. [GridDB technical reference]

![GridDB: Partitionierung](../images/func_partitioning.png)
***Abbildung:** GridDB: Partitionierung* [GridDB technical reference]

## Replikationsmechanismen

Die Replikationsstufen können für den gesamten Cluster festgelegt werden. Jede Partition hat einen Knoten, der die Rolle des Owners hat, außerdem ausreichend Backup-Knoten, um die konfigurierte Replikationsstufe zu erreichen, und jegliche *Catch-Up-Knoten* (catch up, engl. für: aufholen, gleichziehen), die erforderlich sind. *Catch-Up-Knoten* werden immer dann benötigt und eingesetzt, wenn es Schwierigkeiten mit den Backup-Knoten gibt oder wenn nicht genügend Backup-Knoten vorhanden sind, um die Replikationsstufe zu erfüllen. In diesen Fällen sendet der Master-Knoten große Speicherblöcke seiner Partitionsdaten an den Catch-Up-Knoten und überträgt dann Aktualisierungsprotokolle, bis der Catch-Up-Knoten mit dem Partitionsowner synchronisiert ist und zu einem Backup-Knoten hochgestuft wird. [NoSQL Database Architectural Comparison]

Der Master-Knoten überwacht alle Knoten im GridDB-Cluster. Wenn ein Knoten nicht auf die Heartbeat-Nachricht des Master-Knotens antwortet, kennzeichnet dieser den Knoten als betriebsunfähig und weist die Partitionen anderen Kopien zu. Wenn bei einem Ausfall die Replikationsstufe nicht erreicht wurde, wird einem anderen Knoten die Rolle des Catch-Up-Knotens zugewiesen und diese Partition wird die Datenblöcke übertragen, bis die Synchronisation erreicht ist. [NoSQL Database Architectural Comparison]

![GridDB: Replikation](../images/arc_DataPieces.png)
***Abbildung:** GridDB: Replikation* [What is GridDB]

## Unterstützte Programmiersprachen
GridDB wurde in C++ geschrieben und implementiert. Es werden darüber hinaus die Programmiersprachen C, Java, Python, Go, Node.js und Ruby unterstützt. [1][2][3]

Es stehen Python-, Ruby-, Node.js, PHP- und Go-Clients unter GitHub zur Verfügung [2]. Die *GridDB-APIs* (*Application Programming Interface*, engl. für: Programmierschnittstelle) sind Java- und C-basiert. Abfragen können über *TQL* (*Toshiba Query Language*) erfolgen. TQL ist die Abfragesprache von GridDB und ist an SQL angelehnt. [GridDB API Reference]

## APIs und andere Zugriffskonzepte

Abfragen an eine GridDB können entweder über die APIs oder über TQL erfolgen. GridDB unterstützt dabei Standard-Aggregationsfunktionen wie *MIN*, *MAX*, *AVERAGE* und darüber hinaus auf Zeitreihendatenbanken spezialisierte Funktionen wie *TIME-AVG* (time weighted average, engl. für: zeitgewichteter Durchschnitt). [NoSQL Database Architectural Comparison]

Wenn neue Operationen auf einem Container mit einem zuvor festgelegten Auslöser durchgeführt werden, können dazu *JMS*- (*Java Messaging Service*) oder REST-Benachrichtigungen (Representational State Transfer) versendet werden. [GridDB API Reference]

GridDB unterstützt mittels *JDBC*-Treiber (*Java Database Connectivity*) *SQL* (*Structured Query Language*). [GridDB technical reference]

## Einsatzbereiche

GridDB kann für verschiedene Anwendungsbereiche eingesetzt werden. Generell eignen sie sich für den Einsatz in Verbindung mit cyber-physischen Systemen (engl.: cyber-physical system, kurz: *CPS*) und mit Monitoring-Systemen. Einige Beispiele werden im Folgenden aufgelistet.

- **Factory IoT**: Globale Produktionsumgebungen mit *Industrie-4.0*-Konzepten und damit einhergehenden Innovationen erfordern höhere Produktivität und Qualität. Ganze Wertschöpfungsketten müssen optimiert werden. Um diesen Innovationen gerecht zu werden, bietet GridDB hier IoT-basierte Produktionslösungen als IKT-Lösungen (kurz für: Informations- und Kommunikationstechnik) an. [Factory IoT Platform]
- **Automotive Industry**: 
- **Energy**: Ein Beispiel bezieht sich auf die Messung des Energieverbrauchs mit sogenannten Smart Metern, die in den beispielsweise in den stromabnehmenden Haushalten installiert werden. Diese sind über das Internet mit den GridDB-Clustern verbunden. Dort wird der von den Smart Metern erfasste Energieverbrauch gespeichert. Diese Daten werden zwecks automatischer Erstellung der Rechnungen an einen weiteren Cluster übergeben [Owen, „Three Examples of GridDB in the IoT Industry“].
- BEMS
- Smart Community
- Monitoring system


## Vorteile, Besonderheiten und Nachteile 

Transactions in GridDB guarantee ACID (Atomicity, Consistency, Isolation, and Durability) at the container level. [3]


## Literaturverzeichnis

[1] O. Stampflee, NoSQL Database Architectural Comparison. [Online]. Verfügbar unter: https://griddb.net/en/docs/NoSQL_Database_Architectural_Comparison.pdf.

[2] J. Pascascio, „Using GridDB’s C/Python/Ruby APIs“, Fixstars, 21. Sep. 2017, 2017. [Online]. Verfügbar unter: https://griddb.net/en/blog/using-griddbs-cpythonruby-apis/. Zugriff am: 21. Dezember 2021.

[3] GridDB Products | GridDB | TOSHIBA DIGITAL SOLUTIONS CORPORATION. [Online]. Verfügbar unter: https://www.global.toshiba/ww/products-solutions/ai-iot/griddb/product/lineup.html (Zugriff am: 21. Dezember 2021).

[?] Key-Value Stores - DB-Engines Enzyklopädie. [Online]. Verfügbar unter: https://db-engines.com/de/article/Key-Value+Stores (Zugriff am: 25. Dezember 2021).

[?] I. Imru, „Time Series Data and GridDB - GridDB - Medium“, GridDB, 27. Feb. 2019, 2019. [Online]. Verfügbar unter: https://medium.com/griddb/time-series-data-and-griddb-abc9c26f91de. Zugriff am: 4. November 2021.

[?] GridDB technical reference. [Online]. Verfügbar unter: https://www.toshiba.com/solutions/content/GridDB_TechnicalReference.html (Zugriff am: 29. Dezember 2021).

[?] GridDB Reliability and Robustness. [Online]. Verfügbar unter: https://griddb.net/en/docs/GridDB_Reliability_and_Robustness_1.0.7.pdf (Zugriff am: 30. Dezember 2021).

[?] What is GridDB | GridDB | Docs. [Online]. Verfügbar unter: https://docs.griddb.net/about/ (Zugriff am: 30. Dezember 2021).

[?] NoSQL Database Architectural Comparison (Zugriff am: 30. Dezember 2021).

[?] GridDB Systemeigenschaften. [Online]. Verfügbar unter: https://db-engines.com/de/system/GridDB (Zugriff am: 28. Dezember 2021).

[?] GridDB API Reference. [Online]. Verfügbar unter: https://www.toshiba.com/solutions/content/GridDB_API_Reference.html (Zugriff am: 1. Januar 2022).

[?] Factory IoT Platform | TOSHIBA DIGITAL SOLUTIONS CORPORATION. [Online]. Verfügbar unter: https://www.toshiba-sol.co.jp/en/industry/meister_next/?_ga=2.40670306.1790652221.1641133161-1699321142.1640635607 (Zugriff am: 2. Januar 2022).

[?] Owen, „Three Examples of GridDB in the IoT Industry“, Fixstars, 27. März 2017, 2017. [Online]. Verfügbar unter: https://griddb.net/en/blog/three-examples-griddb-iot-industry/. Zugriff am: 2. Januar 2022.
